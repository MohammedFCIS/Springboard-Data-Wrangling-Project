---
title: 'Human Activity Recognition Using Smartphones Data Set'
author: 'Ali Ezzat, Mohammed Ali'
output: html_document
---

# Frame the Problem
Smartlab has developed an experiments with 30volunteers within an age bracket of 19-48 years to record certain daily human activities that has been recorded using accelerometer and gyroscope data from a waist-mounted Android-OS smartphone (Samsung Galaxy S II). The six studied activities are: *Walking*, *Walking Upstairs*, *Walking Downstairs*, *Sitting*, *Standing* and *Laying down* and the [results](http://archive.ics.uci.edu/ml/datasets/Human+Activity+Recognition+Using+Smartphones) are made publicly available. 

So, our goal, as data scientists, to build a model that can detect these activities automatically. To that we have to do the following steps:

* *Process the data (__data wrangling__)*: Real, raw data is rarely usable out of the box. There are errors in data collection, corrupt records, missing values and many other challenges you will have to manage. You will first need to clean the data to convert it to a form that you can further analyze. 

* *Explore the data*: Once we have cleaned the data, we have to understand the information contained within at a high level. What kinds of obvious trends or correlations do you see in the data? What are the high-level characteristics and are any of them more significant than others?

* *Perform in-depth analysis (__build the model__)*: This step is usually the meat of our project,where we apply all the cutting-edge machinery of data analysis to unearth high-value insights and predictions.

This tutorial will focus on the first step and the coming parts will involve the other two steps.

# Process the data
Before moving any further we need to identify the data we have to know how to process it and make it ready for further steps.

## Data description

### Data row
Each row in the dataset consists of the following:

* *Triaxial acceleration* from the __accelerometer__ (total acceleration) and the estimated body acceleration.
* *Triaxial Angular velocity* from the __gyroscope__. 
* A *561-feature vector* with time and frequency domain variables. 
* Its activity label. (_the response variable_)
* An identifier of the subject who carried out the experiment.

This record is divided among several files as follow:

* `train/X_train.txt`: Training set containing all the _561_ features that are listed in `features.txt`.
* `train/subject_train.txt`: Each row identifies the subject who performed the activity for each window sample. Its range is from 1 to 30.
* `train/Inertial Signals/total_acc_x_train.txt`: The acceleration signal from the smartphone accelerometer X axis in standard gravity units 'g'. Every row shows a 128 element vector. The same description applies for the `total_acc_x_train.txt` and `total_acc_z_train.txt` files for the __Y__ and __Z__ axis. 
* `train/Inertial Signals/body_acc_x_train.txt`: The body acceleration signal obtained by subtracting the gravity from the total acceleration. 
* `train/Inertial Signals/body_gyro_x_train.txt`: The angular velocity vector measured by the gyroscope for each window sample. The units are radians/second. 
* `train/y_train.txt`: Activity output (the response variable).

### Data Issues
So what are the issues we have here:
* Each single row is distributed among many files.
* Data columns are not labeled, labels are in seprate files or does not exist.
* Testing data has the same issues. So we will need to process it too.

So, let us start resolving them one by one using [tidyverse](https://www.tidyverse.org/) that contains alot of libraris that are necessary for our data munging. 

```{r load_lib}
suppressMessages(library(tidyverse))
```

## Data processing

### Read Activity (The Response Variable)
We will start by reading the response variable in the `training` dataset.

```{r read_activity}
# Read the variable and assign a name to it
activity <- read_csv("data/train/y_train.txt",  col_names = c("activity_id"))

# Convert it to factor
activity$activity_id <- as.factor(activity$activity_id)

# How much observation we have?
nrow(activity)

# How these observations are distributed?
table(activity$activity_id)
```


### Read Person Ids
```{r}
# Read the subject id and give it label
subject <- read_table("data/train/subject_train.txt", col_names = c("subject_id"))

# How many observation we have here?
nrow(subject)

# Bind Person id  to Training Main Dataset
main <- bind_cols(activity, subject)
```


### Read the feature lables
```{r}
features <- read_table("data/features.txt", col_names = c("feature","feature"))
```
### Make Syntactically Valid Names
```{r}
features_lbls <- make.names(features$feature, unique = TRUE)
```

###Read feature data

####Assign the feature lables to it
```{r}
x_train <- read_table("data/train/X_train.txt", col_names = features_lbls)

# How the data looks like now
glimpse(x_train)
```

#### Bind Activity to Main Data Set
```{r}
main <- bind_cols(main, x_train)
```

### Read Body Triaxial acceleration from the accelerometer
#### Read X Axis
##### Create Name Vector
```{r}
body_acc_x_names <- c()
for (i in 1:128){body_acc_x_names[i] <- "body_acc_x"}
```

#####Make Syntactically Valid Names
```{r}
body_acc_x_names <- make.names(body_acc_x_names, unique = TRUE)
```

#####Read X
```{r}
body_acc_x_train <- tbl_df(read_table("data/train/Inertial Signals/body_acc_x_train.txt", col_names = body_acc_x_names))
```

#####Bind Body X acceleration to Main Data Set
```{r}
main <- bind_cols(main, body_acc_x_train)
```

####Read Y Axis
#####Create Name Vector
```{r}
body_acc_y_names <- c()
for (i in 1:128){body_acc_y_names[i] <- "body_acc_y"}
```

#####Make Syntactically Valid Names
```{r}
body_acc_y_names <- make.names(body_acc_y_names, unique = TRUE)
```

#####Read Y
```{r}
body_acc_y_train <- read_table("data/train/Inertial Signals/body_acc_y_train.txt", col_names = body_acc_y_names)
```

#####Bind Body Y acceleration to Main Data Set
```{r}
main <- bind_cols(main, body_acc_y_train)
```

####Read Z Axis
#####Create Name Vector
```{r}
body_acc_z_names <- c()
for (i in 1:128){body_acc_z_names[i] <- "body_acc_z"}
```

#####Make Syntactically Valid Names
```{r}
body_acc_z_names <- make.names(body_acc_z_names, unique = TRUE)
```

#####Read Z
```{r}
body_acc_z_train <- tbl_df(read_table("data/train/Inertial Signals/body_acc_z_train.txt", col_names = body_acc_z_names))
```

#####Bind Body Z acceleration to Main Data Set
```{r}
main <- bind_cols(main, body_acc_z_train)
```

###Read Total Triaxial acceleration from the accelerometer
####Read X Axis
#####Create Name Vector
```{r}
total_acc_x_names <- c()
for (i in 1:128){total_acc_x_names[i] <- "total_acc_x"}
```

#####Make Syntactically Valid Names
```{r}
total_acc_x_names <- make.names(total_acc_x_names, unique = TRUE)
```

#####Read X
```{r}
total_acc_x_train <- tbl_df(read_table("data/train/Inertial Signals/total_acc_x_train.txt", col_names = total_acc_x_names))
```

#####Bind Body X acceleration to Main Data Set
```{r}
main<- bind_cols(main, total_acc_x_train)
```

####Read Y Axis
#####Create Name Vector
```{r}
total_acc_y_names <- c()
for (i in 1:128){total_acc_y_names[i] <- "total_acc_y"}
```

#####Make Syntactically Valid Names
```{r}
total_acc_y_names <- make.names(total_acc_y_names, unique = TRUE)
```

#####Read Y
```{r}
total_acc_y_train <- tbl_df(read_table("data/train/Inertial Signals/total_acc_y_train.txt", col_names = total_acc_y_names))
```

#####Bind Body Y acceleration to Main Data Set
```{r}
main<- bind_cols(main, total_acc_y_train)
```

####Read Z Axis
#####Create Name Vector
```{r}
total_acc_z_names <- c()
for (i in 1:128){total_acc_z_names[i] <- "total_acc_z"}
```

#####Make Syntactically Valid Names
```{r}
total_acc_z_names <- make.names(total_acc_z_names, unique = TRUE)
```

#####Read Z
```{r}
total_acc_z_train <- tbl_df(read_table("data/train/Inertial Signals/total_acc_z_train.txt", col_names = total_acc_z_names))
```

#####Bind Body Z acceleration to Main Data Set
```{r}
main<- bind_cols(main, total_acc_z_train)
```

###Read Triaxial Angular velocity from the gyroscope
####Read X Axis
#####Create Name Vector
```{r}
body_gyro_x_names <- c()
for (i in 1:128){body_gyro_x_names[i] <- "body_gyro_x"}
```

#####Make Syntactically Valid Names
```{r}
body_gyro_x_names <- make.names(body_gyro_x_names, unique = TRUE)
```

#####Read X
```{r}
body_gyro_x_train <- tbl_df(read_table("data/train/Inertial Signals/body_gyro_x_train.txt", col_names = body_gyro_x_names))
```

#####Bind Body X acceleration to Main Data Set
```{r}
main<- bind_cols(main, body_gyro_x_train)
```

####Read Y Axis
#####Create Name Vector
```{r}
body_gyro_y_names <- c()
for (i in 1:128){body_gyro_y_names[i] <- "body_gyro_y"}
```

#####Make Syntactically Valid Names
```{r}
body_gyro_y_names <- make.names(body_gyro_y_names, unique = TRUE)
```

#####Read Y
```{r}
body_gyro_y_train <- tbl_df(read_table("data/train/Inertial Signals/body_gyro_y_train.txt", col_names = body_gyro_y_names))
```

#####Bind Body Y acceleration to Main Data Set
```{r}
main<- bind_cols(main, body_gyro_y_train)
```

####Read Z Axis
#####Create Name Vector
```{r}
body_gyro_z_names <- c()
for (i in 1:128){body_gyro_z_names[i] <- "body_gyro_z"}
```

#####Make Syntactically Valid Names
```{r}
body_gyro_z_names <- make.names(body_gyro_z_names, unique = TRUE)
```

#####Read Z
```{r}
body_gyro_z_train <- tbl_df(read_table("data/train/Inertial Signals/body_gyro_z_train.txt", col_names = body_gyro_z_names))
```

#####Bind Body Z acceleration to Main Data Set
```{r}
main<- bind_cols(main, body_gyro_z_train)
head(main, 5)
```


##Extracts columns containing mean and standard deviation for each measurements
```{r}
main_std <- main %>% select(contains( "std"))
main_mean <- main %>% select(contains( "mean"))
main_std_mean <- bind_cols(main_std, main_mean)
main_std_mean
```
##Tidy data set with the average of each variable for each activity and each subject.
```{r}
main_av <- main %>% group_by(activity_id, subject_id)%>%  summarise_all(funs(mean))
head(main_av, 5)
```
